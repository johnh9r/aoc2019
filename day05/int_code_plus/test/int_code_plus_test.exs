defmodule IntCodeTestPlus do
  use ExUnit.Case
  doctest IntCodePlus

  setup do
    instructions_and_initalised_data = [
      1,0,0,3,
      1,1,2,3,
      1,3,4,3,
      1,5,0,3,
      2,13,1,19,
      1,10,19,23,
      1,23,9,27,
      1,5,27,31,
      2,31,13,35,
      1,35,5,39,
      1,39,5,43,
      2,13,43,47,
      2,47,10,51,
      1,51,6,55,
      2,55,9,59,
      1,59,5,63,
      1,63,13,67,
      2,67,6,71,
      1,71,5,75,
      1,75,5,79,
      1,79,9,83,
      1,10,83,87,
      1,87,10,91,
      1,91,9,95,
      1,10,95,99,
      1,10,99,103,
      2,103,10,107,
      1,107,9,111,
      2,6,111,115,
      1,5,115,119,
      2,119,13,123,
      1,6,123,127,
      2,9,127,131,
      1,131,5,135,
      1,135,13,139,
      1,139,10,143,
      1,2,143,147,
      1,147,10,0,
      99,
      2, 0, 14, 0
    ]

    insn_data_day5 = [
      3,225,
      1,225,6,6,
      1100,1,238,225,
      104,0,
      1102,46,47,225,
      2,122,130,224,
      101,-1998,224,224,
      4,224,
      1002,223,8,223,
      1001,224,6,224,
      1,224,223,223,
      1102,61,51,225,
      102,32,92,224,
      101,-800,224,224,
      4,224,
      1002,223,8,223,
      1001,224,1,224,
      1,223,224,223,
      1101,61,64,225,
      1001,118,25,224,
      101,-106,224,224,
      4,224,
      1002,223,8,223,
      101,1,224,224,
      1,224,223,223,
      1102,33,25,225,
      1102,73,67,224,
      101,-4891,224,224,
      4,224,
      1002,223,8,223,
      1001,224,4,224,
      1,224,223,223,
      1101,14,81,225,
      1102,17,74,225,
      1102,52,67,225,
      1101,94,27,225,
      101,71,39,224,
      101,-132,224,224,
      4,224,
      1002,223,8,223,
      101,5,224,224,
      1,224,223,223,
      1002,14,38,224,
      101,-1786,224,224,
      4,224,
      102,8,223,223,
      1001,224,2,224,
      1,223,224,223,
      1,65,126,224,
      1001,224,-128,224,
      4,224,
      1002,223,8,223,
      101,6,224,224,
      1,224,223,223,
      1101,81,40,224,
      1001,224,-121,224,
      4,224,
      102,8,223,223,
      101,4,224,224,
      1,223,224,223,
      4,223,
      99,
      0,0,0,677,0,0,0,0,0,0,0,0,0,0,0,1105,0,99999,1105,227,247,1105,1,99999,1005,227,99999,1005,0,256,1105,1,99999,1106,227,99999,1106,0,265,1105,1,99999,1006,0,99999,1006,227,274,1105,1,99999,1105,1,280,1105,1,99999,1,225,225,225,1101,294,0,0,105,1,0,1105,1,99999,1106,0,300,1105,1,99999,1,225,225,225,1101,314,0,0,106,0,0,1105,1,99999,1008,677,226,224,1002,223,2,223,1005,224,329,1001,223,1,223,107,677,677,224,102,2,223,223,1005,224,344,101,1,223,223,1107,677,677,224,102,2,223,223,1005,224,359,1001,223,1,223,1108,226,226,224,1002,223,2,223,1006,224,374,101,1,223,223,107,226,226,224,1002,223,2,223,1005,224,389,1001,223,1,223,108,226,226,224,1002,223,2,223,1005,224,404,1001,223,1,223,1008,677,677,224,1002,223,2,223,1006,224,419,1001,223,1,223,1107,677,226,224,102,2,223,223,1005,224,434,1001,223,1,223,108,226,677,224,102,2,223,223,1006,224,449,1001,223,1,223,8,677,226,224,102,2,223,223,1006,224,464,1001,223,1,223,1007,677,226,224,1002,223,2,223,1006,224,479,1001,223,1,223,1007,677,677,224,1002,223,2,223,1005,224,494,1001,223,1,223,1107,226,677,224,1002,223,2,223,1006,224,509,101,1,223,223,1108,226,677,224,102,2,223,223,1005,224,524,1001,223,1,223,7,226,226,224,102,2,223,223,1005,224,539,1001,223,1,223,8,677,677,224,1002,223,2,223,1005,224,554,101,1,223,223,107,677,226,224,102,2,223,223,1006,224,569,1001,223,1,223,7,226,677,224,1002,223,2,223,1005,224,584,1001,223,1,223,1008,226,226,224,1002,223,2,223,1006,224,599,101,1,223,223,1108,677,226,224,102,2,223,223,1006,224,614,101,1,223,223,7,677,226,224,102,2,223,223,1005,224,629,1001,223,1,223,8,226,677,224,1002,223,2,223,1006,224,644,101,1,223,223,1007,226,226,224,102,2,223,223,1005,224,659,101,1,223,223,108,677,677,224,1002,223,2,223,1006,224,674,1001,223,1,223,4,223,99,226
    ]

    [
      insn_data_day2:
        instructions_and_initalised_data
        |> List.replace_at(1, 12)
        |> List.replace_at(2, 2),
      insn_data_day5:
        insn_data_day5
    ]
  end

  test "(day02pt1) personal challenge data processed correctly (without regressions)", context do
    {0xcafebabe, memory} = IntCodePlus.execute(context[:insn_data_day2])
    assert(memory |> List.first() == 4_930_687)
  end

  test "(day05pt1) personal challenge data processed correctly", context do
    {output, _} = IntCodePlus.execute(context[:insn_data_day5])
    assert(output == 12_896_948)
  end

  test "(day05pt2) personal challenge data processed correctly", context do
    system_id = 5
    {output, _} = IntCodePlus.execute(context[:insn_data_day5], system_id)
    assert(output == 7_704_130)
  end
end
